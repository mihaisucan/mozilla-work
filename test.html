<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      @import "test.css";

      .foobar { color: pink; }

      .test, #test { color: green }
      #test {
        border: 20px solid blue;
      }
      #foobar, #unmatched {
        background: gray;
        color: gray;
        -webkit-bad-property: value;
        -o-bad-property: value;
        -ms-bad-property: value;
        -unknown-property: value;
        woahaha-property: value;
        broken: value;
        background: error;
      }
      #match { text-decoration: underline }
      #editable {
        border: 1px solid blue;
      }
      #editable:focus {
        border: 2px solid red;
      }
    </style>
    <link rel=stylesheet href="test-unmatched.css">
  </head>
  <body>
    <div class="test">hello world!</div>
    <div id="test">hello world!</div>
    <div id="foobar" style="font-weight:bold;color:white">
      <p>hello world!</p>
      <div class="test" style="color:blue;padding:5px;">hello world!</div>
    </div>
    <div class="foobar">foobar</div>
    <div id="match">lolz<p id="dontmatch">foololz</p></div>

    <button id=generateError>generate error!</button>
    <button id=consoleAPI>console api</button>
    <button onclick="doMyXHR()">do XHR</button>
    <button onclick="console.clear()">clear</button>
    <button onclick="console.group('foo')">group</button>
    <button onclick="console.groupEnd('foo')">groupEnd</button>

    <script type="text/javascript"><!--
      //window.console = {};
      //window.console.error = function() { alert("lol") };

      (function () {
        bigDeal = "lolz";

        function foobarTraceMe1(a, b) {
          return foobarTraceMe2(a+1, b+2);
        }

        function foobarTraceMe2(a, b) {
          return foobarTraceMe3(a+1, b+2);
        }

        function foobarTraceMe3(a, b) {
          console.trace();
          return a+1 + b+2;
        }

        var btnGenerateError = document.querySelector("#generateError");
        btnGenerateError.addEventListener("click", function(ev) {
          document.body.childNodes[1000];
          if (ev.preventBubble) {
            ev.preventBubble();
          }
          try {
            foo.bar.intern();
          } catch (ex) {
            window.lastException = ex;
          }
          foo.bar.intern();
        }, false);

        var btnConsoleAPI = document.querySelector("#consoleAPI");
        btnConsoleAPI.addEventListener("click", function(ev) {
          myEventHandler(ev);

          console.time("foo");
          console.dir(document.styleSheets, console);
          foobarTraceMe1(1, 2);
          var result = console.timeEnd("foo");
          console.log("timeEnd result " + result);

          result = console.timeEnd("foo2");
          console.log("timeEnd2 result " + result);

          console.time();
          console.timeEnd();
        }, false);

        var myEventHandler = function (ev, dbg) {
          if (dbg) {
            debugger;
          }

          var result = console.log("log", ev.type, ev);
          console.__returnValue__ = 'test';
          result = console.log("console log result", result);

          /*
          Object.defineProperty(console, "__returnValue__", {
            get: function() {
              return "foo";
            },
            enumerable: true,
            configurable: false
          });*/

          result = console.log("console log result 2", result);

          console.log("console log result 3", result);

          console.info("info " + ev.type);
          console.error("error " + ev.type);
          console.warn("warn " + ev.type);
          console.error("error omg %s %o %d %i %f %a", "aloha", document.body, 
              window.innerWidth, window.innerHeight, Math.PI, "zuzu", null, 
              undefined);
          console.debug("debug", ev.type, ev);
        };

        //document.body.addEventListener('mousedown', myEventHandler, false);
        //document.body.addEventListener('mouseup', myEventHandler, false);
        //document.body.addEventListener('click', myEventHandler, false);
        //document.body.addEventListener('dragstart', myEventHandler, false);
        //document.body.addEventListener('dragend', myEventHandler, false);

        window.myEventHandler = myEventHandler;
      })();

      function createIframeDocument()
      {
        var iframe = document.createElement('iframe');

        iframe.addEventListener("load", function () {
          iframe.removeEventListener("load", arguments.callee, false);

          var div = iframe.contentDocument.createElement('div');
          div.textContent = 'little div';
          iframe.contentDocument.body.appendChild(div);

          var iframe2 = iframe.contentDocument.createElement('iframe');

          iframe2.addEventListener('load', function () {
            iframe2.removeEventListener('load', arguments.callee, false);

            var div2 = iframe2.contentDocument.createElement('div');
            div2.textContent = 'nested div';
            iframe2.contentDocument.body.appendChild(div2);

            var div3 = iframe2.contentDocument.createElement('div');
            div3.textContent = 'big div';
            div3.setAttribute('style', 'height:500px; width:500px; border:1px solid gray;');

            iframe2.contentDocument.body.appendChild(div3);
          }, false);

          iframe2.src = 'data:text/html,nested iframe';
          iframe2.setAttribute("style", iframe.getAttribute("style"));
          iframe.contentDocument.body.appendChild(iframe2);
        }, false);

        iframe.src = 'data:text/html,little iframe';
        iframe.setAttribute("style",
            "padding: 10px; border: 5px solid red; width: 350px; height: 250px");

        var placeholder = document.getElementById("iframesplaceholder");
        placeholder.appendChild(iframe);
      }

      function doMyXHR()
      {
        var req = new XMLHttpRequest();
        req.open('GET', 'http://www.mozilla.org/', true);
        req.onreadystatechange = function() {
          if (req.readyState == 4) {
            console.log("XHR done");
          }
        };
        req.send(null);
      };

      window.addEventListener('load', createIframeDocument, false);

      (function(){
      var req = new XMLHttpRequest();
      req.open('GET', 'http://www.mozilla.org/', true);
      req.onreadystatechange = function() {
        if (req.readyState == 4) {
          console.log("XHR done");
          xhrException();
          console.log("XHR - should not execute!");
        }
      };
      req.send(null);
      })();

      window.foobarObject = {a: 1, b: 2, c: 3};

    // --></script>

<script type="application/javascript;version=1.8">
(function(){
function nukeFunc() {
  var a = 5;
  while(a < 10)
    yield a++;
}

window.nuke = nukeFunc();
nuke.next();


var lang = { name: 'JavaScript', birthYear: 1995, blabla: "cucu" };
window.nuke2 = Iterator(lang);

function Range(low, high){
  this.low = low;
  this.high = high;
}

function RangeIterator(range){
  this.range = range;
  this.current = this.range.low;
}

RangeIterator.prototype.next = function(){
  if (this.current > this.range.high)
    throw StopIteration;
  else
    return this.current++;
};

Range.prototype.__iterator__ = function(){
  return new RangeIterator(this);
};

window.nuke3 = new Range(3, 15);

window.nuke4 = (i * 2 for (i in nuke3));

window.myGettersAndSetters = {
  _cucu: 5,
  get cucuRigu() { return this._cucu++; },
  set cucuRigu(val) { this._cucu = val; },
};

})();

function scrollTest()
{
  // just enlarge #bigarea so i have something to scroll.
  var elem = document.getElementById("bigarea");
  let height = (window.innerHeight * 2) + "px";
  if (elem.style.height == height)
    elem.style.height = "auto";
  else
    elem.style.height = height;
}

function myDoPaste()
{
  document.execCommand("paste", false, null);
}

function myOnPaste(e)
{
  console.log("onpaste!");
}

function myOnMouseDown(e)
{
  return;
  console.log("myOnMouseDown", e.type, "which", e.which, "phase", e.eventPhase);
  if (e.which == 3) {
    console.log("myOnMouseDown preventDefault");
    var div = document.querySelector("div[contenteditable]");
    div.contentEditable = false;
    e.preventDefault();
    e.stopPropagation();
    if (e.stopImmediatePropagation) {
      e.stopImmediatePropagation();
    }
  }
}

function myOnMouseUp(e)
{
  return;
  console.log("myOnMouseUp", e.type, "which", e.which, "phase", e.eventPhase);
  if (e.which == 3) {
    console.log("myOnMouseUp preventDefault");
    e.preventDefault();
    e.stopPropagation();
    if (e.stopImmediatePropagation) {
      e.stopImmediatePropagation();
    }
  }
}

function myOnClick(e)
{
  return;
  console.log("myOnClick", e.type, "which", e.which, "phase", e.eventPhase);
  if (e.which == 3) {
    console.log("myOnClick preventDefault");
    e.preventDefault();
    e.stopPropagation();
    if (e.stopImmediatePropagation) {
      e.stopImmediatePropagation();
    }
  }
}

function myOnContextMenu(e)
{
  return;
  console.log("myOnContextMenu", e.type, "phase", e.eventPhase);
  e.preventDefault();
  e.stopPropagation();
  if (e.stopImmediatePropagation) {
    e.stopImmediatePropagation();
  }
}

window.addEventListener("load", function _onload() {
    window.removeEventListener("load", _onload, false);

    var div = document.querySelector("div[contenteditable]");
    document.body.addEventListener("mousedown", myOnMouseDown, true);
    document.body.addEventListener("mouseup", myOnMouseUp, true);
    document.body.addEventListener("click", myOnClick, true);
    document.body.addEventListener("contextmenu", myOnContextMenu, true);
}, false);

</script>
    <script type="application/javascript;version=1.7" src="test.js"></script>
    <img src="lolz.png">
    <div id="iframesplaceholder" style="display:inline"></div>
    <p><button onclick="scrollTest()">scroll test</button> <button onclick="myEventHandler(event, true)">debug!</button></p>
    <div style="border: 1px red solid" id="bigarea">big area</div>
    <p>booo</p>
    <div id="editable">
      <div>div#editable</div>
      <div contenteditable="" onpaste="myOnPaste(event)">foo bar pre 
      editable</div>
    </div>
    <textarea>foo</textarea>
    <p><button onclick="myDoPaste()">paste!</button></p>
  </body>
</html>
