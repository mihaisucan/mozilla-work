#!/bin/bash

# Quickly start dbg/opt mozilla firefox builds.

MY_SELF="${0##*/}"

#export CC="ccache gcc"
#export CXX="ccache g++"
export CC=clang
export CXX=clang++

if [[ "$1" == "-dbg" ]]
then
  cp ~/src/mozilla-scripts/mozconfig/dbg .mozconfig
else
  cp ~/src/mozilla-scripts/mozconfig/opt .mozconfig
fi

if [[ ! -f client.mk ]]
then
  echo "file not found: client.mk"
  exit 1
fi

if [[ ! -f .mozconfig ]]
then
  echo "file not found: .mozconfig"
  exit 1
fi

make -f client.mk build

if [[ "$?" -eq 0 ]]
then
  notify-send "$MY_SELF" "Build ready. It took $SECONDS seconds to build Mozilla." -i "info" -u "low"
  echo "Build ready. It took $SECONDS seconds to build Mozilla.";
else
  notify-send "$MY_SELF" "Build failed. It took $SECONDS seconds to fail." -i "error" -u "critical"

  echo "Build failed. It took $SECONDS seconds to fail.";
fi
