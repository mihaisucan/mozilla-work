#!/bin/bash

# This script allows me to start the mozilla build from my cloned repo.

MY_DIR="$( cd -P "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
source "$MY_DIR/../../config.local"

gdb=n
dbg=n

for i do
  case $i in
    ('-gdb')
      gdb=y
      dbg=y
      ;;
    ('-dbg')
      dbg=y
      ;;
  esac
done

if [[ ! -d "$CFG_BUILDS_DIR" ]]
then
  echo "folder not found: $CFG_BUILDS_DIR"
  exit 1
fi

if [[ "$dbg" == "y" ]]
then
  ffdir="$CFG_BUILDS_DIR/$MY_SRC_DIR/dbg/dist/bin"
else
  ffdir="$CFG_BUILDS_DIR/$MY_SRC_DIR/opt/dist/bin"
fi

if [[ ! -d "$ffdir" ]]
then
  echo "folder not found: $ffdir"
  exit 1
fi

cd "$ffdir"

if [[ ! -f "firefox" || ! -x "firefox" ]]
then
  echo "file not found or file not executable: firefox"
  exit 1
fi

cmd="./firefox -no-remote"

if [[ "$gdb" == "y" ]]
then
  cmd="$cmd -g"
fi

cmd="$cmd -P mozilla-central -purgecaches"

echo "$cmd";
echo;
$cmd
echo "Firefox ran for $SECONDS seconds."
